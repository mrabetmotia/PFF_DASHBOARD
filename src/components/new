import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import { useAuth } from '@/context/AuthContext';
import jwt_decode from 'jwt-decode';
import { MenuItem, List, ListItem, ListItemIcon, ListItemText, Avatar, Typography } from '@mui/material';
import Link from 'next/link';

function Navbar() {
  const { isLoggedIn, logout } = useAuth();
  const router = useRouter();
  const [formData, setFormData] = useState({ nom: '' });

  const handleChange = (event) => {
    setFormData({ ...formData, [event.target.name]: event.target.value });
  };

  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      try {
        const decoded = jwt_decode(token);
        setFormData((prevFormData) => ({
          ...prevFormData,
          email: decoded.email || '',
          nom: decoded.first_name || ''
        }));
      } catch (error) {
        console.error('Invalid token', error);
      }
    }
  }, []);

  const handleLogoutClick = () => {
    logout();
    router.push('/');
  };

  return (
    <>
      <div className="sidebar">
        <div className="side-content">
          <Avatar style={{ backgroundImage: "url(/img/1.jpeg)" }}></Avatar>
          <Typography variant="h4">{formData.nom}  {formData.prenom}</Typography>
          <Typography variant="body1">{formData.email}</Typography>
          <List>
            <ListItem button component={Link} href="/home">
              <ListItemIcon>
                <span className="las la-home"></span>
              </ListItemIcon>
              <ListItemText primary="Home" />
            </ListItem>
            <ListItem button component={Link} href="/shop">
              <ListItemIcon>
                <span className="las la-store-alt"></span>
              </ListItemIcon>
              <ListItemText primary="Liste Shop" />
            </ListItem>
            <ListItem button component={Link} href="/commande">
              <ListItemIcon>
                <span className="las la-store-alt"></span>
              </ListItemIcon>
              <ListItemText primary="Liste Commande" />
            </ListItem>
            <ListItem button component={Link} href="/coach">
              <ListItemIcon>
                <span className="las la-user-graduate"></span>
              </ListItemIcon>
              <ListItemText primary="Liste Coach" />
            </ListItem>
            <ListItem button component={Link} href="/excercice">
              <ListItemIcon>
                <span className="las la-clipboard-list"></span>
              </ListItemIcon>
              <ListItemText primary="Liste Exsercice" />
            </ListItem>
            <ListItem button component={Link} href="/user">
              <ListItemIcon>
                <span className="las la-user"></span>
              </ListItemIcon>
              <ListItemText primary="Liste User" />
            </ListItem>
            <ListItem button component={Link} href="/type">
              <ListItemIcon>
                <span className="las la-tasks"></span>
              </ListItemIcon>
              <ListItemText primary="Type" />
            </ListItem>
          </List>
        </div>
      </div>
      {isLoggedIn ? (
        <div className="main-content">
          <header>
            <div className="header-content">
              <MenuItem onClick={handleLogoutClick} sx={menuItemStyles}>Logout</MenuItem>
            </div>
          </header>
        </div>
      ) : (
        <div className="main-content">
          <header>
            <div className="header-content">
              <MenuItem onClick={handleLogoutClick}>Login</MenuItem>
            </div>
          </header>
        </div>
      )}
    </>
  );
}

const menuItemStyles = {
  fontSize: '14px',
  fontWeight: 600,
  '&:hover': {
    color: 'red',
    transform: 'scale(1.1)',
  },
};

export default Navbar;